# git 业务实战分享

## 前言

一般会有同学疑问？

咿？git还有啥业务实战分享？来来去去不就是五个命令吗？

```
git pull // 获取最新线上代码
git checkout -b feat/XXX // 切新开发分支
====开发====
git add . // 添加代码到暂存区
git commit -m "注释 写给自己看或者是领导看" // 提交最好是加注释 防止万一
git push // 推送远程
```

单人开发或者多人无冲突开发，这几个命令够用了。

但是出现突发情况需要你处理，比如出现冲突不想合并，误操作合错分支（把test代码合到开发分支），线上代码回滚等待其他情况。

这时候大脑就会出现灵魂三问。

我是谁？

我在哪？

我在做什么？

git真到那么简单吗？

## git简介

Git是一个开源的分布式版本控制系统，可以有效、高速地处理从很小到非常大的项目版本管理。

### git的由来
Linus Torvalds ，这个人我相信大家都知道吧，开源 Linux 系统的发明人。

如今，你看到的大部分服务器其实都是运行在 Linux 系统上，令人感到称叹的是，这位大神级别的程序员不仅创造了 Linux  系统。

那 Linux 的代码是如何管理的呢？2002年之前，世界各地的志愿者把源代码文件通过 diff 的方式发给 Linus，然后由 Linus 本人通过手工方式合并代码！要知道，当时的 Linux 的代码量已经很大了，通过人工管理的方式，一是容易出错，二是效率低。

于是 Linus 选择了一个商业的版本控制系统 BitKeeper，BitKeeper 的东家 BitMover 公司出于人道主义精神，授权 Linux 社区免费使用这个版本控制系统。最后，出于某种原因，BitMover 公司收回了 Linux 社区的免费使用权，

于是 Linus 花了两周时间自己用 C 语言 写了一个分布式版本控制系统，这就是 Git 的由来了。

![Linus Torvalds](./img/people.image)

## 为什么要用git

首先需要了解什么是集中式和分布式版本控制系统

### 集中式和分布式版本控制系统的概念

集中式的版本控制系统：CVS及SVN；

集中式版本控制系统：

> 1. 版本库是集中存放在中央服务器的
> 2. 干活的时候，用的都是自己的电脑，所以要先从中央服务器取得最新的版本，然后开始干活，干完活了，再把自己的活推送给中央服务器。
> 3. 中央服务器就好比是一个图书馆，你要改一本书，必须先从图书馆借出来，然后回到家自己改，改完了，再放回图书馆。

优点：每个人都可以一定程度上看到项目中的其他人正在做些什么。而管理员也可以轻松掌控每个开发者的权限。

缺点：必须联网（局域网）才能工作，中央服务器的单点故障，故障期间谁都无法提交更新、还原、对比等。

分布式版本控制系统：
> 1. 分布式版本控制系统根本没有“中央服务器”，每个人的电脑上都是一个完整的版本库,所以你不需要联网；
> 2. 那多个人如何协作呢？比方说你在自己电脑上改了文件A，你的同事也在他的电脑上改了文件A，这时，你们俩之间只需把各自的修改推送给对方，就可以互相看到对方的修改了；
> 3. 现实中，分布式版本控制系统通常也有一台充当“中央服务器”的电脑，但这个服务器的作用仅仅是用来方便“交换”大家的修改，没有它大家也一样干活，只是交换修改不方便而已；

优点：无需联网，强大的分支管理等（ SVN 分支是拷贝的目录，Git 分支是指针指向某次提交，这个特性使 Git 的分支切换非常迅速，且创建成本非常低）；

缺点：Git复杂概念和命令多，对新手不太友好；

## git的工作区域和流程

Git 最核心的一个概念就是工作流。

![git](./img/git.png)

> * 工作区(Workspace) 就是平时进行开发改动的地方，是当前看到最新的内容，在开发的过程也就是对工作区的操作。
> * 暂存区(Index) 当执行 `git add` 的命令后，工作区的文件就会被移入暂存区，暂存区标记了当前工作区中那些内容是被 Git 管理的，当完成某个需求或者功能后需要提交代码，第一步就是通过 `git add` 先提交到暂存区。
> * 本地仓库区(Repository) 位于自己的电脑上，通过 git commit 提交暂存区的内容，会进入本地仓库。
> * 远程仓库(Remote) 用来托管代码的服务器，远程仓库的内容能够被分布在多个地点的处于协作关系的本地仓库修改，本地仓库修改完代码后通过 git push 命令同步代码到远程仓库,可以理解为目的是为了协调统一多个本地仓库代码的中转站；


另一种理解方式，git内部文件有三种状态：已修改（modified）、已暂存（staged）、已提交（committed）；

> * 已修改表示修改了某个文件，但还没有提交保存;
> * 已暂存表示把已修改的文件放在下次提交时要保存的清单中;
> * 已提交表示该文件已经被安全地保存在本地数据库中了;

由此我们看到 Git 管理项目时，文件流转的三个工作区域：Git 的工作目录，暂存区域，以及本地仓库。

最后`git push`推送命令，就是将本地仓库变更记录推到远程仓库，保持一致；

通常提交代码分为几步：
> * 在工作区开发，添加，修改文件;
> * git add 从工作区提交到暂存区;
> * git commit 从暂存区提交到本地仓库;
> * git push 从本地仓库提交到远程仓库;

一般来说，记住以下命令，便可进行日常工作了

## 业务中使用git解决问题场景

### Git merge和rebase分支合并命令的区别

### git pull 和git pull --rebase 使用

场景1: A同学和B同学同时在分支`feat/demo1`分支开发代码，A同学开发完代码先提交，B同学后开发完代码提交代码，git报错了，提醒我们远程分支有新的commit未同步到本地，无法推送？
解决方案1: 执行`git pull`,同步远程分支到本地，再提交；
解决方案2: 执行`git pull --rebase`,同步远程分支到本地，再提交；

tips：
1. `git pull` 等同于 `git fetch && git merge`;
2. `git pull rebase` 等同于`git fetch && git rebase`
